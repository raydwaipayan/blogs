<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux Kernel checkpatch.pl mentorship | Dwai's blogs</title><meta name=keywords content><meta name=description content="Checkpatch - What is it? checkpatch.pl is a trivial style checker for patches sent to the linux kernel.
Why is it needed you say? I did an analysis on checkpatch warnings on about 50k commits from v5.4. (Find the full report here )
The top errors were then generated via the following shell command:
cat checkpatch_out_50k.txt | grep -oP &#34;(?:WARNING|ERROR|CHECK):(\w+)&#34; \ | sort | uniq -c | sort -nr | head -n6    Count of errors Error Types Error     41999 CHECK CAMELCASE   13629 CHECK PARENTHESIS_ALIGNMENT   11491 WARNING LONG_LINE   8106 CHECK SPACING   6825 WARNING LEADING_SPACE   4394 CHECK OPEN_ENDED_LINE    Hmm&mldr;The no."><meta name=author content><link rel=canonical href=https://raydwaipayan.github.io/blogs/posts/linux-kernel-mentorship/><link href=/blogs/assets/css/stylesheet.min.1eef9c740af75b4e5f773d9d5f757e03e3df71f3a308e73070cc73d55a59a7d7.css integrity="sha256-Hu+cdAr3W05fdz2dX3V+A+PfcfOjCOcwcMxz1VpZp9c=" rel="preload stylesheet" as=style><link rel=icon href=https://raydwaipayan.github.io/blogs/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://raydwaipayan.github.io/blogs/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://raydwaipayan.github.io/blogs/favicon-32x32.png><link rel=apple-touch-icon href=https://raydwaipayan.github.io/blogs/apple-touch-icon.png><link rel=mask-icon href=https://raydwaipayan.github.io/blogs/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><meta property="og:title" content="Linux Kernel checkpatch.pl mentorship"><meta property="og:description" content="Checkpatch - What is it? checkpatch.pl is a trivial style checker for patches sent to the linux kernel.
Why is it needed you say? I did an analysis on checkpatch warnings on about 50k commits from v5.4. (Find the full report here )
The top errors were then generated via the following shell command:
cat checkpatch_out_50k.txt | grep -oP &#34;(?:WARNING|ERROR|CHECK):(\w+)&#34; \ | sort | uniq -c | sort -nr | head -n6    Count of errors Error Types Error     41999 CHECK CAMELCASE   13629 CHECK PARENTHESIS_ALIGNMENT   11491 WARNING LONG_LINE   8106 CHECK SPACING   6825 WARNING LEADING_SPACE   4394 CHECK OPEN_ENDED_LINE    Hmm&mldr;The no."><meta property="og:type" content="article"><meta property="og:url" content="https://raydwaipayan.github.io/blogs/posts/linux-kernel-mentorship/"><meta property="article:published_time" content="2021-03-06T02:05:17+05:30"><meta property="article:modified_time" content="2021-03-06T02:05:17+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux Kernel checkpatch.pl mentorship"><meta name=twitter:description content="Checkpatch - What is it? checkpatch.pl is a trivial style checker for patches sent to the linux kernel.
Why is it needed you say? I did an analysis on checkpatch warnings on about 50k commits from v5.4. (Find the full report here )
The top errors were then generated via the following shell command:
cat checkpatch_out_50k.txt | grep -oP &#34;(?:WARNING|ERROR|CHECK):(\w+)&#34; \ | sort | uniq -c | sort -nr | head -n6    Count of errors Error Types Error     41999 CHECK CAMELCASE   13629 CHECK PARENTHESIS_ALIGNMENT   11491 WARNING LONG_LINE   8106 CHECK SPACING   6825 WARNING LEADING_SPACE   4394 CHECK OPEN_ENDED_LINE    Hmm&mldr;The no."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://raydwaipayan.github.io/blogs/posts/"},{"@type":"ListItem","position":3,"name":"Linux Kernel checkpatch.pl mentorship","item":"https://raydwaipayan.github.io/blogs/posts/linux-kernel-mentorship/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux Kernel checkpatch.pl mentorship","name":"Linux Kernel checkpatch.pl mentorship","description":"Checkpatch - What is it? checkpatch.pl is a trivial style checker for patches sent to the linux kernel.\nWhy is it needed you say? I did an analysis on checkpatch warnings on about …","keywords":[],"articleBody":"Checkpatch - What is it? checkpatch.pl is a trivial style checker for patches sent to the linux kernel.\nWhy is it needed you say? I did an analysis on checkpatch warnings on about 50k commits from v5.4. (Find the full report here )\nThe top errors were then generated via the following shell command:\ncat checkpatch_out_50k.txt | grep -oP \"(?:WARNING|ERROR|CHECK):(\\w+)\" \\ | sort | uniq -c | sort -nr | head -n6    Count of errors Error Types Error     41999 CHECK CAMELCASE   13629 CHECK PARENTHESIS_ALIGNMENT   11491 WARNING LONG_LINE   8106 CHECK SPACING   6825 WARNING LEADING_SPACE   4394 CHECK OPEN_ENDED_LINE    Hmm…The no. of stylistically incorrect bits still continue to exist and are still merged into the kernel code. To make the kernel code more stylistically coherent, we can:\n  Create cleanup patches for the existing code Make sure new patches are stylistically consistent   Both of these are where checkpatch comes handy.\nCheckpatch in the patch submission process Before sending out the patches to the mailing list, it is recommended to run checkpatch over the patches.\nIn general, a Kernel developer would:\n  Create the patch with his proposed changes. Build check the patch, run additional tools like checkstack, sparse etc. Run checkpatch.pl over the patches to eliminate all trivial style violations. Send out the patch to the maintainers and mailing list.   The only catch here is that checkpatch is not always right. It is just a dumb perl script. If the code looks better with checkpatch errors, let it be.\nDrawbacks of checkpatch Checkpatch is only a static trivial style checker. It does not have the capabilities of a full c based parser like clang-format. In this sense it is limited in what it can do. Still, it is highly valuable as a style checker tool and can ease the work of maintainers and increase the chances of the patch being accepted by the community.\nWhat did we do to improve it? Over the first 3 months of my mentorship period, I primarily focused on eliminating false-positives from checkpatch as well as adding new rules.\nConsider the following patch commit log:\n#include asm/bitsperlong.h avoid further potential userspace pollution by moving the #define of SHIFT_PER_LONG to bitops.h which is not exported to userspace. A kernel developer in 2020 would not see any checkpatch warning.\nA kernel developer in 2021 would see the following warning:\nWARNING: Commit log lines starting with '#' are dropped by git as comments #82: #include asm/bitsperlong.h avoid further potential userspace pollution During the last 3 months I worked on two major features:\n  Addition of a verbose mode to checkpatch Addition of an external documentation to checkpatch   For the documentation we decided to document all checkpatch message types, their meanings and how to resolve them. This is still a work in progress. Contributions are definitely welcome :-P.\nVerbose Mode This was one of the new additions we did to checkpatch.\nOne can run checkpatch like this:\n./scripts/checkpatch.pl -v test.patch All verbose descriptions can be seen by pairing the verbose option with –list-types:\n./scripts/checkpatch.pl --list-types -v Checkpatch Documentation The checkpatch documentation can be viewed from the kernel root at Documentation/dev-tools/checkpatch.rst.\nTo build the documentation make sure you have configured sphynx either in the system or in a python virtualenv. Next the kernel doc can be built using:\nmake htmldocs How to contribute to the documentation? The documentation is still a work in progress. Feel free to send the patches to the kernel-doc mailing list, and add me (Dwaipayan Ray dwaipayanray1@gmail.com) and Lukas (Lukas Bulwahn lukas.bulwahn@gmail.com) for reviewing it.\nThe documentation is writted in rst syntax. Refer here for a quick guide.\nBefore sending out the mail, please always:\n  checkpatch.pl your changes build check your patch (in this case check the generated html docs) spell check your patch (this can be easily done through checkpatch using –codespell flag if you already have the codespell dictionary)   Acknowledgements During my mentorship period I learned a lot from my mentors. I would like to thank Lukas for his constant support as my mentor, Joe for his guidance with checkpatch and everyone in the community for being such amazing people.\nThe kernel contribution process may look old but it works. This is due to the dedication of everyone in the community, which I am glad to be a part of.\n","wordCount":"710","inLanguage":"en","datePublished":"2021-03-06T02:05:17+05:30","dateModified":"2021-03-06T02:05:17+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://raydwaipayan.github.io/blogs/posts/linux-kernel-mentorship/"},"publisher":{"@type":"Organization","name":"Dwai's blogs","logo":{"@type":"ImageObject","url":"https://raydwaipayan.github.io/blogs/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://raydwaipayan.github.io/blogs accesskey=h title="Dwai's blogs (Alt + H)">Dwai's blogs</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Linux Kernel checkpatch.pl mentorship</h1><div class=post-meta>March 6, 2021</div></header><div class=post-content><h2 id=checkpatch---what-is-it>Checkpatch - What is it?<a hidden class=anchor aria-hidden=true href=#checkpatch---what-is-it>#</a></h2><p><a href=https://github.com/torvalds/linux/blob/master/scripts/checkpatch.pl>checkpatch.pl</a> is a trivial style checker for patches sent to the linux kernel.</p><p>Why is it needed you say?</br>I did an analysis on checkpatch warnings on about 50k commits from v5.4.</br>(Find the full report <a href=https://raydwaipayan.github.io/blogs/checkpatch_out_50k.txt>here
</a>)</p><p>The top errors were then generated via the following shell command:</p><pre><code class=language-/bin/bash data-lang=/bin/bash>cat checkpatch_out_50k.txt | grep -oP &quot;(?:WARNING|ERROR|CHECK):(\w+)&quot; \
| sort | uniq -c | sort -nr  | head -n6
</code></pre><table><thead><tr><th>Count of errors</th><th>Error Types</th><th>Error</th></tr></thead><tbody><tr><td>41999</td><td><span style=color:green>CHECK</span></td><td>CAMELCASE</td></tr><tr><td>13629</td><td><span style=color:green>CHECK</span></td><td>PARENTHESIS_ALIGNMENT</td></tr><tr><td>11491</td><td><span style=color:orange>WARNING</span></td><td>LONG_LINE</td></tr><tr><td>8106</td><td><span style=color:green>CHECK</span></td><td>SPACING</td></tr><tr><td>6825</td><td><span style=color:orange>WARNING</span></td><td>LEADING_SPACE</td></tr><tr><td>4394</td><td><span style=color:green>CHECK</span></td><td>OPEN_ENDED_LINE</td></tr></tbody></table><p>Hmm&mldr;The no. of stylistically incorrect bits still continue to exist and
are still merged into the kernel code. To make the kernel code more
stylistically coherent, we can:</p><blockquote><ul><li>Create cleanup patches for the existing code</li><li>Make sure new patches are stylistically consistent</li></ul></blockquote><p>Both of these are where checkpatch comes handy.</p><h2 id=checkpatch-in-the-patch-submission-process>Checkpatch in the patch submission process<a hidden class=anchor aria-hidden=true href=#checkpatch-in-the-patch-submission-process>#</a></h2><p>Before sending out the patches to the mailing list, it is recommended to
run checkpatch over the patches.</p><p>In general, a Kernel developer would:</p><blockquote><ul><li>Create the patch with his proposed changes.</li><li>Build check the patch, run additional tools like checkstack, sparse etc.</li><li>Run checkpatch.pl over the patches to eliminate all trivial style violations.</li><li>Send out the patch to the maintainers and mailing list.</li></ul></blockquote><p>The only catch here is that checkpatch is not always right. It is just a dumb
perl script. If the code looks better with checkpatch errors, let it be.</p><h2 id=drawbacks-of-checkpatch>Drawbacks of checkpatch<a hidden class=anchor aria-hidden=true href=#drawbacks-of-checkpatch>#</a></h2><p>Checkpatch is only a static trivial style checker. It does not have the
capabilities of a full c based parser like <a href=https://www.kernel.org/doc/html/latest/process/clang-format.html>clang-format</a>. In this sense it is limited in
what it can do. Still, it is highly valuable as a style checker tool and can
ease the work of maintainers and increase the chances of the patch being accepted
by the community.</p><h2 id=what-did-we-do-to-improve-it>What did we do to improve it?<a hidden class=anchor aria-hidden=true href=#what-did-we-do-to-improve-it>#</a></h2><p>Over the first 3 months of my mentorship period, I primarily focused on
eliminating false-positives from checkpatch as well as adding new rules.</p><p>Consider the following patch commit log:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff>#include asm/bitsperlong.h avoid further potential userspace pollution
by moving the #define of SHIFT_PER_LONG to bitops.h which is not
exported to userspace.
</code></pre></div><p>A kernel developer in 2020 would not see any checkpatch warning.</p><p>A kernel developer in 2021 would see the following warning:</p><pre><code class=language-\bin\bash data-lang=\bin\bash>WARNING: Commit log lines starting with '#' are dropped by git as comments
#82: 
#include asm/bitsperlong.h avoid further potential userspace pollution
</code></pre><p>During the last 3 months I worked on two major features:</p><blockquote><ul><li>Addition of a verbose mode to checkpatch</li><li>Addition of an external documentation to checkpatch</li></ul></blockquote><p>For the documentation we decided to document all checkpatch message types,
their meanings and how to resolve them. This is still a work in progress.
Contributions are definitely welcome :-P.</p><h3 id=verbose-mode>Verbose Mode<a hidden class=anchor aria-hidden=true href=#verbose-mode>#</a></h3><p>This was one of the new additions we did to checkpatch.</p><p>One can run checkpatch like this:</p><pre><code class=language-/bin/bash data-lang=/bin/bash>./scripts/checkpatch.pl -v test.patch
</code></pre><p>All verbose descriptions can be seen by pairing the verbose option
with &ndash;list-types:</p><pre><code class=language-/bin/bash data-lang=/bin/bash>./scripts/checkpatch.pl --list-types -v
</code></pre><h3 id=checkpatch-documentation>Checkpatch Documentation<a hidden class=anchor aria-hidden=true href=#checkpatch-documentation>#</a></h3><p>The checkpatch documentation can be viewed from the kernel root
at <code>Documentation/dev-tools/checkpatch.rst</code>.</p><p>To build the documentation make sure you have configured sphynx
either in the system or in a python virtualenv. Next the kernel
doc can be built using:</p><pre><code class=language-/bin/bash data-lang=/bin/bash>make htmldocs
</code></pre><h2 id=how-to-contribute-to-the-documentation>How to contribute to the documentation?<a hidden class=anchor aria-hidden=true href=#how-to-contribute-to-the-documentation>#</a></h2><p>The documentation is still a work in progress. Feel free to send
the patches to the kernel-doc mailing list, and add me (Dwaipayan
Ray <a href=mailto:dwaipayanray1@gmail.com>dwaipayanray1@gmail.com</a>) and Lukas (Lukas Bulwahn <a href=mailto:lukas.bulwahn@gmail.com>lukas.bulwahn@gmail.com</a>) for reviewing it.</p><p>The documentation is writted in rst syntax. Refer
<a href=http://openalea.gforge.inria.fr/doc/openalea/doc/_build/html/source/sphinx/rest_syntax.html>here</a> for a quick guide.</p><p>Before sending out the mail, please always:</p><blockquote><ul><li>checkpatch.pl your changes</li><li>build check your patch (in this case check the generated html docs)</li><li>spell check your patch (this can be easily done through checkpatch
using &ndash;codespell flag if you already have the codespell dictionary)</li></ul></blockquote><h2 id=acknowledgements>Acknowledgements<a hidden class=anchor aria-hidden=true href=#acknowledgements>#</a></h2><p>During my mentorship period I learned a lot from my mentors.
I would like to thank Lukas for his constant support as my mentor,
Joe for his guidance with checkpatch and everyone in the community for being such
amazing people.</p><p>The kernel contribution process may look old but it works. This is due to the dedication of everyone in the community, which I am glad to be a part of.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://raydwaipayan.github.io/blogs>Dwai's blogs</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/blogs/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>